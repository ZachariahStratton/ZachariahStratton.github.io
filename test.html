<html>
        <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        </head>
        <body>
		
        <div id="navbar"><span>3D Sock Design Viewer v1.015</span></div>
        <script src="./three.min.js"></script>
        <script src="./OBJLoader.js"></script>
        <script src="./MTLLoader.js"></script>
        <script src="./OrbitControls.js"></script>
        <script src="./ImageUtils.js"></script>
		
		<!-- Source: https://jsfiddle.net/f2Lommf5/4991/ -->
		<script type='text/javascript'>
		let camera, scene, renderer, mesh;

		init();
		animate();
		
		var globalObject;
			
		function init() {
		
			//Upload texture button
			var inputFileToLoad = document.createElement("input");
			inputFileToLoad.type = "file";
			inputFileToLoad.id = "inputFileToLoad";
			document.body.appendChild(inputFileToLoad);

			var buttonLoadFile = document.createElement("button");
			buttonLoadFile.onclick = applyTexture;
			buttonLoadFile.textContent = "Apply Texture";
			document.body.appendChild(buttonLoadFile);

			//create scene for 3D model
		    camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 10);
		    camera.position.z = 1;
		    scene = new THREE.Scene();
			
			/*
			scene = new THREE.Scene();
			camera = new THREE.PerspectiveCamera(90, 1280/720, 0.1, 1000);
			
			mesh = new THREE.Mesh(
				new THREE.BoxGeometry(1,1,1),
				new THREE.MeshPhongMaterial({color:0xff4444})
			);
			mesh.position.y += 1;
			mesh.receiveShadow = true;
			mesh.castShadow = true;
			//scene.add(mesh);
			
			meshFloor = new THREE.Mesh(
				new THREE.PlaneGeometry(20,20, 10,10),
				new THREE.MeshPhongMaterial({color:0xffffff})
			);
			meshFloor.rotation.x -= Math.PI / 2;
			meshFloor.receiveShadow = true;
			scene.add(meshFloor);
			*/
			
			ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
			scene.add(ambientLight);
			
			light = new THREE.PointLight(0xffffff, 0.8, 18);
			light.position.set(-3,6,-3);
			light.castShadow = true;
			light.shadow.camera.near = 0.1;
			light.shadow.camera.far = 25;
			scene.add(light);
			
			//Load default textures
			var tLoader = new THREE.TextureLoader();
			var texture1 = tLoader.load('img.jpg');
			
			//create basic block and add texture1 (img.jpg) to it
		    const geometry = new THREE.BoxBufferGeometry(0.4, 0.4, 0.4);
			const material = new THREE.MeshBasicMaterial({
				map: texture1
			});

		    mesh = new THREE.Mesh(geometry, material);
		    //scene.add(mesh);
			
			//Create 3D model from obj file

			// load a resource
			/*
			var mtlLoader = new THREE.MTLLoader();
			mtlLoader.load("block.mtl", function(materials){
				
				materials.preload();
				var objLoader = new THREE.OBJLoader();
				objLoader.setMaterials(materials);
				
				objLoader.load("sock.obj", function(mesh){
				
					mesh.traverse(function(node){
						if( node instanceof THREE.Mesh ){
							node.castShadow = true;
							node.receiveShadow = true;
						}
					});
				
					scene.add(mesh);
					mesh.position.set(0, 0, 0);
					mesh.rotation.y = -Math.PI/4;
				});
				
			});
			*/
			
			var objLoader = new THREE.OBJLoader();
			
			objLoader.load("sock.obj", function(mesh){
				globalObject = mesh;
				mesh.traverse( function ( child ) {
					if ( child instanceof THREE.Mesh ) {
						child.material.map = THREE.ImageUtils.loadTexture('img.jpg');
						child.material.needsUpdate = true;
					}
				} );
				
				mesh.position.set(-.5, 0, 0);
				mesh.rotation.y = -Math.PI/4;
				scene.add(mesh);
			});
			
			camera.position.set(0, 0, -5);
			camera.lookAt(new THREE.Vector3(0,1.8,0));
			
			renderer = new THREE.WebGLRenderer();
			renderer.setSize(1280, 720);

			renderer.shadowMap.enabled = true;
			renderer.shadowMap.type = THREE.BasicShadowMap;
			
			document.body.appendChild(renderer.domElement);
			
			//add controls to rotate
			controls = new THREE.OrbitControls (camera, renderer.domElement);
			
			function applyTexture()
			{
				var filesSelected = document.getElementById("inputFileToLoad").files;
				if (filesSelected.length > 0)
				{
					var fileToLoad = filesSelected[0];

					if (fileToLoad.type.match("image.*"))
					{
						var fileReader = new FileReader();
						fileReader.onload = function(fileLoadedEvent) 
						{
							var loader2 = new THREE.TextureLoader();
							newTexture = loader2.load(fileLoadedEvent.target.result);
							//mesh.material.map = newTexture;
							
							mesh.traverse( function ( child ) {
								if ( child instanceof THREE.Mesh ) {
									child.material.map = THREE.ImageUtils.loadTexture(fileLoadedEvent.target.result);
									child.material.needsUpdate = true;
								}
							} );
						};
						fileReader.readAsDataURL(fileToLoad);
					}
				}
			}
		}

		function animate() {

			controls.update();
			requestAnimationFrame(animate);
			renderer.render(scene, camera);

		}
		
		</script>
		
        </body>
</html>