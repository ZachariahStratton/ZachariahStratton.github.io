<html>
        <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        </head>
        <body>
		
        <div id="navbar"><span>3D Sock Design Viewer v1.043</span></div>
        <script src="./three.min.js"></script>
        <script src="./OBJLoader.js"></script>
        <script src="./MTLLoader.js"></script>
        <script src="./GLTFLoader.js"></script>
        <script src="./OrbitControls.js"></script>
        <script src="./Color.js"></script>
		
		<!-- Source: https://jsfiddle.net/f2Lommf5/4991/ -->
		<script type='text/javascript'>
		let camera, scene, renderer, mesh;

		init();
		animate();
		
		var globalObject;
			
		function init() {
			var linebreak = document.createElement("br");
			
			//Upload texture button
			var inputFileToLoad = document.createElement("input");
			inputFileToLoad.type = "file";
			inputFileToLoad.id = "inputFileToLoad";
			document.body.appendChild(inputFileToLoad);

			var buttonLoadFile = document.createElement("button");
			buttonLoadFile.onclick = applyTexture;
			buttonLoadFile.textContent = "Apply Texture";
			document.body.appendChild(buttonLoadFile);
			document.body.appendChild(linebreak);
			
			//create scene for 3D model
		    //camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 10);
		    camera = new THREE.PerspectiveCamera(45, 2, 0.1, 100);
		    camera.position.z = 1;
		    scene = new THREE.Scene();
			scene.background = new THREE.Color('white');
			
			ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
			scene.add(ambientLight);
			
			light = new THREE.PointLight(0xffffff, 0.8, 18);
			light.position.set(-3,6,-3);
			light.castShadow = true;
			light.shadow.camera.near = 0.1;
			light.shadow.camera.far = 25;
			scene.add(light);
			
			//Load default textures
			var tLoader = new THREE.TextureLoader();
			var texture1 = tLoader.load('img.jpg');
			var material1 = new THREE.MeshPhongMaterial({map: texture1});
			
			//Create 3D model
			//load gltf file
			var gLoader = new THREE.GLTFLoader();
			
			gLoader.load('sock.gltf', function ( gltf ) {
				scene.add( gltf.scene );
				}
			);
			
			
			/*
			// load both obj and mtl file
			var mtlLoader = new THREE.MTLLoader();
			mtlLoader.load("sock.mtl", function(materials){
				
				materials.preload();
				
				var objLoader = new THREE.OBJLoader();
				objLoader.setMaterials(materials);
				
				objLoader.load("sock.obj", function(mesh){
					mesh.traverse(function(node){
						if( node.isMesh ){
							node.material = material1;
							node.material.needsUpdate = true;
							node.castShadow = true;
							node.receiveShadow = true;
						}
					});
				
					mesh.position.set(0, 0, 0);
					mesh.rotation.y = -Math.PI/4;
					scene.add(mesh);
				});
			});
			*/
			
			
			/*
			//load only obj file
			var objLoader = new THREE.OBJLoader();
			
			objLoader.load("sock.obj", function(mesh){
				globalObject = mesh;
				mesh.traverse( function ( child ) {
					if ( child instanceof THREE.Mesh ) {
						child.material.map = texture1;
						child.material.needsUpdate = true;
					}
				} );
				
				mesh.position.set(0, 0, 0);
				mesh.rotation.y = -Math.PI/4;
				scene.add(mesh);
			});
			*/
			
			camera.position.set(0, 0, -.5);
			camera.lookAt(new THREE.Vector3(0,1.8,0));
			
			renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth * 0.4, window.innerHeight * 0.4);

			renderer.shadowMap.enabled = true;
			renderer.shadowMap.type = THREE.BasicShadowMap;
			
			document.body.appendChild(renderer.domElement);
			
			//add controls to rotate
			controls = new THREE.OrbitControls (camera, renderer.domElement);
			controls.target = new THREE.Vector3(0,.15,0);
			controls.update();
			
			//grid for measurements
			var gridXZ = new THREE.GridHelper(100, 10);
			gridXZ.setColors( new THREE.Color('black'), new THREE.Color('black') );
			scene.add(gridXZ);
			
			function applyTexture()
			{
				var filesSelected = document.getElementById("inputFileToLoad").files;
				if (filesSelected.length > 0)
				{
					var fileToLoad = filesSelected[0];

					if (fileToLoad.type.match("image.*"))
					{
						var fileReader = new FileReader();
						fileReader.onload = function(fileLoadedEvent) 
						{
							var loader2 = new THREE.TextureLoader();
							newTexture = loader2.load(fileLoadedEvent.target.result);
							mesh.material.map = newTexture;
							
							globalObject.traverse( function ( child ) {
								if ( child instanceof THREE.Mesh ) {
									child.material = newTexture;
									child.material.needsUpdate = true;
								}
							} );
						};
						fileReader.readAsDataURL(fileToLoad);
					}
				}
			}
			
		}

		function animate() {

			controls.update();
			requestAnimationFrame(animate);
			renderer.render(scene, camera);

		}
		
		</script>
		
        </body>
</html>